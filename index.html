<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Cursor Timeline Viewer</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display",
          "Segoe UI", Roboto, sans-serif;
        background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        overflow: hidden;
        color: white;
      }

      .container {
        flex: 1;
        display: flex;
        flex-direction: column;
        padding: 20px;
        max-width: 100vw;
        max-height: 100vh;
      }

      .viewer-container {
        flex: 1;
        display: flex;
        justify-content: center;
        align-items: center;
        position: relative;
        margin-bottom: 40px;
        overflow: hidden;
      }

      .screenshot-wrapper {
        position: relative;
        max-width: 95%;
        max-height: 100%;
        border-radius: 16px;
        overflow: hidden;
        box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
      }

      .screenshot {
        display: block;
        width: 100%;
        height: auto;
        border-radius: 16px;
      }

      .cursor-overlay {
        position: absolute;
        width: 20px;
        height: 20px;
        pointer-events: none;
        transition: all 0.15s cubic-bezier(0.4, 0, 0.2, 1);
        z-index: 10;
      }

      .cursor-dot {
        width: 20px;
        height: 20px;
        background: radial-gradient(
          circle,
          rgba(255, 59, 92, 0.9) 0%,
          rgba(255, 59, 92, 0.6) 60%,
          transparent 100%
        );
        border-radius: 50%;
        box-shadow: 0 0 20px rgba(255, 59, 92, 0.6);
        animation: pulse 2s ease-in-out infinite;
      }

      @keyframes pulse {
        0%,
        100% {
          transform: scale(1);
          opacity: 0.9;
        }
        50% {
          transform: scale(1.2);
          opacity: 1;
        }
      }

      .controls {
        backdrop-filter: blur(40px) saturate(180%);
        background: rgba(255, 255, 255, 0.08);
        border: 1px solid rgba(255, 255, 255, 0.12);
        border-radius: 20px;
        padding: 30px 40px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
      }

      .timeline-container {
        position: relative;
        margin-bottom: 20px;
      }

      .timeline-label {
        display: flex;
        justify-content: space-between;
        margin-bottom: 12px;
        font-size: 13px;
        opacity: 0.7;
        font-weight: 500;
      }

      .slider-wrapper {
        position: relative;
        width: 100%;
        height: 8px;
        margin: 20px 0;
      }

      .slider-track {
        position: absolute;
        width: 100%;
        height: 4px;
        top: 2px;
        background: rgba(255, 255, 255, 0.15);
        border-radius: 2px;
      }

      .slider-progress {
        position: absolute;
        height: 4px;
        top: 2px;
        background: linear-gradient(90deg, #ff3b5c 0%, #ff6b8a 100%);
        border-radius: 2px;
        transition: width 0.1s ease;
      }

      input[type="range"] {
        -webkit-appearance: none;
        appearance: none;
        width: 100%;
        height: 8px;
        background: transparent;
        outline: none;
        position: relative;
        z-index: 2;
        cursor: pointer;
      }

      input[type="range"]::-webkit-slider-thumb {
        -webkit-appearance: none;
        appearance: none;
        width: 24px;
        height: 24px;
        background: linear-gradient(135deg, #fff 0%, #f0f0f0 100%);
        border-radius: 50%;
        cursor: grab;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3),
          0 0 0 4px rgba(255, 255, 255, 0.1);
        transition: transform 0.2s ease, box-shadow 0.2s ease;
      }

      input[type="range"]::-webkit-slider-thumb:hover {
        transform: scale(1.1);
        box-shadow: 0 6px 16px rgba(0, 0, 0, 0.4),
          0 0 0 6px rgba(255, 255, 255, 0.15);
      }

      input[type="range"]::-webkit-slider-thumb:active {
        cursor: grabbing;
        transform: scale(1.05);
      }

      input[type="range"]::-moz-range-thumb {
        width: 24px;
        height: 24px;
        background: linear-gradient(135deg, #fff 0%, #f0f0f0 100%);
        border-radius: 50%;
        border: none;
        cursor: grab;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3),
          0 0 0 4px rgba(255, 255, 255, 0.1);
        transition: transform 0.2s ease, box-shadow 0.2s ease;
      }

      input[type="range"]::-moz-range-thumb:hover {
        transform: scale(1.1);
        box-shadow: 0 6px 16px rgba(0, 0, 0, 0.4),
          0 0 0 6px rgba(255, 255, 255, 0.15);
      }

      input[type="range"]::-moz-range-thumb:active {
        cursor: grabbing;
        transform: scale(1.05);
      }

      .info {
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 14px;
        opacity: 0.9;
      }

      .timestamp {
        font-weight: 600;
        letter-spacing: 0.5px;
      }

      .position {
        opacity: 0.7;
        font-variant-numeric: tabular-nums;
      }

      .loading {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        text-align: center;
        z-index: 1000;
      }

      .spinner {
        width: 50px;
        height: 50px;
        margin: 0 auto 20px;
        border: 3px solid rgba(255, 255, 255, 0.2);
        border-top-color: #ff3b5c;
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      .hidden {
        display: none;
      }

      @media (max-width: 768px) {
        .container {
          padding: 10px;
        }

        .controls {
          padding: 20px;
          border-radius: 16px;
        }

        .info {
          flex-direction: column;
          gap: 8px;
          align-items: flex-start;
        }
      }
    </style>
  </head>
  <body>
    <div class="loading" id="loading">
      <div class="spinner"></div>
      <div>Loading timeline data...</div>
    </div>

    <div class="container hidden" id="app">
      <div class="viewer-container">
        <div class="screenshot-wrapper" id="screenshotWrapper">
          <img class="screenshot" id="screenshot" alt="Screenshot" />
          <div class="cursor-overlay" id="cursorOverlay">
            <div class="cursor-dot"></div>
          </div>
        </div>
      </div>

      <div class="controls">
        <div class="timeline-container">
          <div class="timeline-label">
            <span>Timeline</span>
            <span id="frameCounter">0 / 0</span>
          </div>
          <div class="slider-wrapper">
            <div class="slider-track"></div>
            <div class="slider-progress" id="sliderProgress"></div>
            <input
              type="range"
              id="timelineSlider"
              min="0"
              max="0"
              value="0"
              step="1"
            />
          </div>
        </div>

        <div class="info">
          <div class="timestamp" id="timestamp">--:--:--</div>
          <div class="position" id="position">x: --- | y: ---</div>
        </div>
      </div>
    </div>

    <script>
      let timelineData = [];
      let currentIndex = 0;

      // DOM elements
      const loading = document.getElementById("loading");
      const app = document.getElementById("app");
      const screenshot = document.getElementById("screenshot");
      const screenshotWrapper = document.getElementById("screenshotWrapper");
      const cursorOverlay = document.getElementById("cursorOverlay");
      const timelineSlider = document.getElementById("timelineSlider");
      const sliderProgress = document.getElementById("sliderProgress");
      const timestamp = document.getElementById("timestamp");
      const position = document.getElementById("position");
      const frameCounter = document.getElementById("frameCounter");

      // Load and parse CSV
      async function loadData() {
        try {
          const response = await fetch(
            "__cursor_data/mouse_positions_test_tracker.csv"
          );
          const text = await response.text();
          const lines = text.trim().split("\n").slice(1); // Skip header

          timelineData = lines
            .map((line) => {
              const [ts, dt, x, y, screenshotPath] = line.split(",");
              return {
                timestamp: parseFloat(ts),
                datetime: dt,
                x: parseFloat(x),
                y: parseFloat(y),
                screenshot: screenshotPath,
              };
            })
            .filter((item) => item.screenshot); // Filter out any empty entries

          // Initialize UI
          timelineSlider.max = timelineData.length - 1;
          frameCounter.textContent = `1 / ${timelineData.length}`;

          // Load first frame
          await updateFrame(0);

          // Show app
          loading.classList.add("hidden");
          app.classList.remove("hidden");
        } catch (error) {
          console.error("Error loading data:", error);
          loading.innerHTML = "<div>Error loading timeline data</div>";
        }
      }

      // Update frame based on index
      async function updateFrame(index) {
        if (index < 0 || index >= timelineData.length) return;

        currentIndex = index;
        const data = timelineData[index];

        // Update image
        screenshot.src = data.screenshot;

        // Wait for image to load to get dimensions
        await new Promise((resolve) => {
          if (screenshot.complete) {
            resolve();
          } else {
            screenshot.onload = resolve;
          }
        });

        // Update cursor position (coordinates are halved because screenshot is downsampled)
        const cursorX = data.x / 2;
        const cursorY = data.y / 2;

        // Position cursor relative to the image
        cursorOverlay.style.left = `${cursorX}px`;
        cursorOverlay.style.top = `${cursorY}px`;

        // Update info
        const date = new Date(data.timestamp * 1000);
        timestamp.textContent = date.toLocaleTimeString();
        position.textContent = `x: ${Math.round(data.x)} | y: ${Math.round(
          data.y
        )}`;
        frameCounter.textContent = `${index + 1} / ${timelineData.length}`;

        // Update progress bar
        const progress = (index / (timelineData.length - 1)) * 100;
        sliderProgress.style.width = `${progress}%`;
      }

      // Slider input handler
      timelineSlider.addEventListener("input", (e) => {
        const index = parseInt(e.target.value);
        updateFrame(index);
      });

      // Keyboard controls
      document.addEventListener("keydown", (e) => {
        if (e.key === "ArrowLeft" && currentIndex > 0) {
          timelineSlider.value = currentIndex - 1;
          updateFrame(currentIndex - 1);
        } else if (
          e.key === "ArrowRight" &&
          currentIndex < timelineData.length - 1
        ) {
          timelineSlider.value = currentIndex + 1;
          updateFrame(currentIndex + 1);
        }
      });

      // Preload images for smoother transitions
      function preloadImages() {
        timelineData.forEach((data, index) => {
          // Preload images around current position
          if (Math.abs(index - currentIndex) < 5) {
            const img = new Image();
            img.src = data.screenshot;
          }
        });
      }

      // Preload on slider change
      timelineSlider.addEventListener("input", () => {
        setTimeout(preloadImages, 100);
      });

      // Initialize
      loadData();
    </script>
  </body>
</html>
